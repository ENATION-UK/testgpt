FROM autotest-base:latest

# 设置代理环境变量
ENV https_proxy=http://192.168.2.99:7012
ENV http_proxy=http://192.168.2.99:7012
ENV all_proxy=socks5://192.168.2.99:7012

# 复制依赖文件
COPY pyproject.toml uv.lock ./

# 安装Python依赖
RUN pip install --no-cache-dir -e .

# 复制应用代码
COPY . .

# 暴露端口
EXPOSE 8000

# 启动命令 - 使用bash直接执行
CMD ["bash", "-c", "Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 & sleep 2 && python run.py"] 